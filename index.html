<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NavAI - AI Image Generation</title>
    <link rel="stylesheet" href="style.css?v=3">
</head>
<body>
<header class="navbar">
    <a href="index.html" class="logo">NavAI</a>
    <nav>
        <ul>
            <li><a href="index.html">Home</a></li>
            <li><a href="about.html">About</a></li>
            <li><a href="plans.html">Plans</a></li>
            <li><a href="contact.html">Contact</a></li>
        </ul>
    </nav>
</header>

<section class="hero">
    <h1>Welcome to NavAI</h1>
    <p>Create amazing AI-generated images instantly.</p>
    <a href="generate.html" class="cta" id="generate-now-btn">Generate Now</a>
</section>

<section class="features">
    <h2>Features</h2>
    <div class="feature-list">
        <div class="feature">
            <h3>Fast Generation</h3>
            <p>Generate images instantly with AI.</p>
        </div>
        <div class="feature">
            <h3>Creative Control</h3>
            <p>Adjust prompts and styles to match your vision.</p>
        </div>
        <div class="feature">
            <h3>AI-Powered</h3>
            <p>Cutting-edge models create stunning results.</p>
        </div>
    </div>
</section>

<!-- Simple Auth Button -->
<div style="text-align: center; margin-top: 30px;">
  <button onclick="showAuth('signup')" style="background: rgba(0,191,255,0.2); border: 1px solid #00bfff; color: #00bfff; padding: 12px 30px; border-radius: 25px; cursor: pointer; font-size: 16px;">
    üöÄ Sign Up / Login (Get 10 Free Credits)
  </button>
</div>

<!-- Auth Modal -->
<div id="auth-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 10000; justify-content: center; align-items: center;">
  <div style="background: #1a1a2e; padding: 30px; border-radius: 15px; width: 90%; max-width: 400px; border: 1px solid #00bfff;">
    <h3 style="color: #00bfff; text-align: center;" id="auth-title">Join NavAI - Get 10 Free Credits</h3>
    <div id="auth-message" style="margin: 10px 0; padding: 10px; border-radius: 5px; display: none;"></div>
    <form id="auth-form">
      <input type="email" id="auth-email" placeholder="Your Email" required style="width: 100%; padding: 12px; margin: 10px 0; border-radius: 8px; border: 1px solid #333; background: #0a0f1f; color: white;">
      <input type="password" id="auth-password" placeholder="Password" required style="width: 100%; padding: 12px; margin: 10px 0; border-radius: 8px; border: 1px solid #333; background: #0a0f1f; color: white;">
      <button type="submit" id="auth-submit-btn" style="width: 100%; padding: 12px; background: #00bfff; color: white; border: none; border-radius: 8px; margin: 10px 0; cursor: pointer;">Sign Up & Get Credits</button>
    </form>
    <div id="auth-switch" style="text-align: center; margin-top: 15px;">
      <button onclick="switchAuthMode()" id="auth-switch-btn" style="background: none; border: none; color: #00bfff; cursor: pointer;">
        Already have an account? Login
      </button>
    </div>
    <button onclick="closeAuth()" style="background: none; border: none; color: #888; cursor: pointer; margin-top: 10px; width: 100%;">Maybe later</button>
  </div>
</div>

<!-- Success Message Display (hidden by default) -->
<div id="success-message" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 10001; justify-content: center; align-items: center;">
  <div style="background: #1a1a2e; padding: 30px; border-radius: 15px; width: 90%; max-width: 400px; border: 1px solid #00ff00; text-align: center;">
    <div style="font-size: 48px; margin-bottom: 20px;">‚úÖ</div>
    <h3 style="color: #00ff00; margin-bottom: 15px;">Email Verified Successfully!</h3>
    <p style="color: white; margin-bottom: 20px;">Your account has been activated with 10 free credits! You can now log in and start generating images.</p>
    <button onclick="closeSuccess()" style="padding: 10px 30px; background: #00ff00; color: black; border: none; border-radius: 6px; cursor: pointer; font-size: 16px; font-weight: bold;">
      Continue to Login
    </button>
  </div>
</div>

<!-- Error Message Display (hidden by default) -->
<div id="error-message" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 10001; justify-content: center; align-items: center;">
  <div style="background: #1a1a2e; padding: 30px; border-radius: 15px; width: 90%; max-width: 400px; border: 1px solid #ff6b6b; text-align: center;">
    <div style="font-size: 48px; margin-bottom: 20px;">‚ùå</div>
    <h3 style="color: #ff6b6b; margin-bottom: 15px;" id="error-title">Verification Error</h3>
    <p style="color: white; margin-bottom: 20px;" id="error-description"></p>
    <button onclick="closeError()" style="padding: 10px 30px; background: #ff6b6b; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 16px;">
      OK
    </button>
  </div>
</div>

<footer class="footer">
    <p>&copy; 2025 NavAI. All rights reserved.</p>
</footer>

<script>
let currentAuthMode = 'signup';

function showAuth(mode = 'signup') {
  currentAuthMode = mode;
  updateAuthUI();
  document.getElementById('auth-modal').style.display = 'flex';
  document.getElementById('auth-message').style.display = 'none';
  document.getElementById('auth-form').reset();
}

function closeAuth() {
  document.getElementById('auth-modal').style.display = 'none';
}

function switchAuthMode() {
  currentAuthMode = currentAuthMode === 'signup' ? 'login' : 'signup';
  updateAuthUI();
}

function updateAuthUI() {
  const title = document.getElementById('auth-title');
  const submitBtn = document.getElementById('auth-submit-btn');
  const switchBtn = document.getElementById('auth-switch-btn');
  
  if (currentAuthMode === 'signup') {
    title.textContent = 'Join NavAI - Get 10 Free Credits';
    submitBtn.textContent = 'Sign Up & Get Credits';
    switchBtn.textContent = 'Already have an account? Login';
  } else {
    title.textContent = 'Login to Your Account';
    submitBtn.textContent = 'Login';
    switchBtn.textContent = 'Don\'t have an account? Sign Up';
  }
}

function showSuccess() {
  document.getElementById('success-message').style.display = 'flex';
}

function closeSuccess() {
  document.getElementById('success-message').style.display = 'none';
  showAuth('login');
}

function showError(title, description) {
  document.getElementById('error-title').textContent = title;
  document.getElementById('error-description').textContent = description;
  document.getElementById('error-message').style.display = 'flex';
}

function closeError() {
  document.getElementById('error-message').style.display = 'none';
  window.history.replaceState({}, document.title, window.location.pathname);
}

// Handle email verification (both success and error)
function handleVerification() {
  // Check for SUCCESSFUL verification first (from hash)
  const hash = window.location.hash.substring(1);
  if (hash.includes('access_token')) {
    const params = new URLSearchParams(hash);
    const access_token = params.get('access_token');
    const type = params.get('type');
    
    if (access_token && type === 'signup') {
      showSuccess();
      window.history.replaceState({}, document.title, window.location.pathname);
      return;
    }
  }
  
  // Check for ERRORS (from query parameters)
  const urlParams = new URLSearchParams(window.location.search);
  const error = urlParams.get('error');
  const errorDescription = urlParams.get('error_description');
  
  if (error) {
    let title = 'Verification Failed';
    let description = 'The verification link is invalid or has expired.';
    
    if (error === 'access_denied') {
      if (errorDescription?.includes('expired')) {
        title = 'Link Expired';
        description = 'This verification link has expired. Please request a new verification email.';
      } else {
        title = 'Invalid Link';
        description = 'This verification link is invalid or has already been used.';
      }
    }
    
    showError(title, description);
  }
}

// Handle Generate Now button
document.getElementById('generate-now-btn').addEventListener('click', function(e) {
  const userId = localStorage.getItem('navai_userId');
  if (!userId) {
    e.preventDefault();
    showAuth('signup');
  }
});

document.getElementById('auth-form').addEventListener('submit', async function(e) {
  e.preventDefault();
  const email = document.getElementById('auth-email').value;
  const password = document.getElementById('auth-password').value;
  
  try {
    const response = await fetch('/api/auth', {
      method: 'POST',
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify({ 
        action: currentAuthMode, 
        email, 
        password 
      })
    });
    
    const data = await response.json();
    const messageEl = document.getElementById('auth-message');
    
    if (data.success) {
      if (data.needsVerification) {
        messageEl.style.background = '#2a2a4a';
        messageEl.style.color = '#00bfff';
        messageEl.innerHTML = `
          <strong>üìß VERIFICATION EMAIL SENT!</strong><br>
          Check your inbox (and spam folder) for the verification link.<br>
          <strong>You MUST click the link to activate your account and get your 10 free credits.</strong>
        `;
        messageEl.style.display = 'block';
        document.getElementById('auth-form').reset();
      } else {
        messageEl.style.background = '#1a3a1a';
        messageEl.style.color = '#00ff00';
        messageEl.textContent = data.message || '‚úÖ Login successful!';
        messageEl.style.display = 'block';
        localStorage.setItem('navai_userId', data.userId);
        localStorage.setItem('navai_credits', data.credits);
        localStorage.setItem('navai_email', email);
        setTimeout(() => {
          closeAuth();
          window.location.href = 'generate.html';
        }, 1500);
      }
    } else {
      messageEl.style.background = '#3a1a1a';
      messageEl.style.color = '#ff6b6b';
      messageEl.textContent = data.message;
      messageEl.style.display = 'block';
    }
  } catch (error) {
    const messageEl = document.getElementById('auth-message');
    messageEl.style.background = '#3a1a1a';
    messageEl.style.color = '#ff6b6b';
    messageEl.textContent = 'Network error. Please try again.';
    messageEl.style.display = 'block';
  }
});

// Initialize
document.addEventListener('DOMContentLoaded', function() {
  updateAuthUI();
  handleVerification(); // Check for verification on page load
});
</script>
<script src="script.js?v=4"></script>
</body>
</html>
